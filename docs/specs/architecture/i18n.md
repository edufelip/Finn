# Internationalization (i18n) Specification

## Purpose
Provides a centralized mechanism for managing multi-language support, dynamic string formatting, and RTL (Right-to-Left) layout support.

## Supported Languages
The system supports **7 languages**:
- **English** (en) - LTR
- **Portuguese** (pt) - LTR
- **Spanish** (es) - LTR
- **French** (fr) - LTR
- **German** (de) - LTR
- **Japanese** (ja) - LTR
- **Arabic** (ar) - **RTL**

Each language contains **633 translation keys** for a total of **4,431 translations**.

## Architecture

### Core Components
1. **LocalizationProvider** (`src/app/providers/LocalizationProvider.tsx`)
   - React context provider for locale state management
   - RTL detection and I18nManager integration
   - Automatic RTL switching for Arabic
   - Provides `locale`, `setLocale`, and `isRTL` to components

2. **Translation System** (`src/presentation/i18n/`)
   - `strings.ts`: Translation key-value mappings for all languages
   - `index.ts`: Translation function `t()` with interpolation support
   - `i18nConfig.ts`: i18next configuration with pluralization
   - `dateFormatter.ts`: Locale-aware date/time formatting utilities

3. **Date Formatting** (`src/presentation/i18n/dateFormatter.ts`)
   - `formatDate()`: Standard date formatting per locale
   - `formatRelativeTime()`: Relative time strings (e.g., "2 hours ago")
   - `formatDateDistance()`: Distance between dates
   - `formatPostTimestamp()`: Smart formatting for post timestamps
   - `formatChatTimestamp()`: Smart formatting for chat messages

## Functional Requirements

### Translation
- **FR-I18N-01**: The system shall provide a way to translate keys into the current locale's strings.
- **FR-I18N-02**: The system shall support variable interpolation in translation strings using `{variable}` syntax.
- **FR-I18N-03**: The system shall support retrieving lists of strings.
- **FR-I18N-04**: The system shall return the key itself if a translation is missing (fallback behavior).
- **FR-I18N-05**: The system shall log missing translation keys in development mode.

### RTL (Right-to-Left) Support
- **FR-I18N-06**: The system shall detect Arabic locale and enable RTL layout.
- **FR-I18N-07**: The system shall use React Native's I18nManager to force RTL when Arabic is selected.
- **FR-I18N-08**: The system shall alert the user to restart the app when switching to/from RTL languages.
- **FR-I18N-09**: The system shall provide `isRTL` boolean context value for conditional styling.

### Date Formatting
- **FR-I18N-10**: The system shall format dates according to the current locale's conventions.
- **FR-I18N-11**: The system shall support relative time formatting ("just now", "5 minutes ago").
- **FR-I18N-12**: The system shall handle locale-specific number systems (e.g., Arabic numerals).

### Pluralization
- **FR-I18N-13**: The system shall support pluralization rules via i18next.
- **FR-I18N-14**: The system shall handle language-specific plural forms (singular, plural, zero forms).

## Use Cases

### UC-I18N-01: Display Interpolated String
1. UI component requests translation for `post.postedBy` with `{ name: 'John' }`.
2. System replaces `{name}` in the string `"Posted by {name}"`.
3. UI displays "Posted by John".

### UC-I18N-02: Change Language
1. User navigates to Settings screen.
2. User taps language button (e.g., "日本語" for Japanese).
3. System calls `setLocale('ja')`.
4. All UI text immediately updates to Japanese.
5. LocalizationProvider updates context and persists preference.

### UC-I18N-03: Enable RTL Layout (Arabic)
1. User navigates to Settings screen.
2. User taps "العربية" (Arabic) button.
3. System detects RTL language and calls `I18nManager.forceRTL(true)`.
4. Alert appears: "Restart Required - Please restart the app for the layout direction to change".
5. User restarts app.
6. App layout is now RTL (navigation, text alignment, icons reversed).

### UC-I18N-04: Format Post Timestamp
1. Post component calls `formatPostTimestamp(postDate, locale)`.
2. System evaluates time difference:
   - If < 1 minute: Returns "Just now"
   - If < 1 hour: Returns "5 minutes ago"
   - If today: Returns "Today at 3:45 PM"
   - If yesterday: Returns "Yesterday at 2:30 PM"
   - Else: Returns "Jan 24, 2026"
3. Formatting follows current locale conventions (Japanese: "2026年1月24日", Arabic: "٢٤ يناير ٢٠٢٦").

## Test Cases

### Translation Function
- **TC-I18N-01**: Verify that if a translation key is missing, the system returns the key itself as a fallback.
- **TC-I18N-02**: Verify that string lists (e.g., suggested topics) are correctly retrieved as arrays.
- **TC-I18N-03**: Verify that interpolation replaces `{variable}` with provided values.
- **TC-I18N-04**: Verify that missing interpolation variables are handled gracefully.

### Language Support
- **TC-I18N-05**: Verify all 7 languages have exactly 633 translation keys.
- **TC-I18N-06**: Verify no translation keys are missing across any language.
- **TC-I18N-07**: Verify no translation values are empty strings.
- **TC-I18N-08**: Verify all placeholder consistency across languages (e.g., `{count}` exists in all translations of a key).

### RTL Support
- **TC-I18N-09**: Verify Arabic locale enables RTL layout after app restart.
- **TC-I18N-10**: Verify `isRTL` context value is `true` when Arabic is active.
- **TC-I18N-11**: Verify switching from Arabic to English disables RTL.
- **TC-I18N-12**: Verify Arabic text contains Arabic script (Unicode U+0600-U+06FF).

### Date Formatting
- **TC-I18N-13**: Verify date formatting matches locale conventions for all 7 languages.
- **TC-I18N-14**: Verify relative time strings are correct ("just now", "5 minutes ago", "2 hours ago").
- **TC-I18N-15**: Verify Arabic numerals display correctly in Arabic locale (e.g., ٢٤).

### Script Validation
- **TC-I18N-16**: Verify Japanese translations contain Japanese script (Hiragana/Katakana/Kanji: U+3040-U+309F, U+30A0-U+30FF, U+4E00-U+9FFF).
- **TC-I18N-17**: Verify critical translation keys exist in all languages (`auth.login`, `auth.logout`, `tabs.home`, etc.).

## Implementation Details

### Translation Keys
Translation keys follow a hierarchical naming convention:
- `common.*` - Shared UI elements (cancel, error, etc.)
- `auth.*` - Authentication screens
- `tabs.*` - Bottom tab navigation
- `settings.*` - Settings screen
- `post.*` - Post-related text
- `community.*` - Community-related text
- `language.*` - Language display names

Example:
```typescript
t('post.postedBy', { name: 'John' }) // "Posted by John"
t('auth.login') // "Login"
t('language.ja') // "日本語"
```

### RTL Implementation
When Arabic is selected:
1. `LocalizationProvider` detects `locale === 'ar'`
2. Calls `I18nManager.allowRTL(true)` and `I18nManager.forceRTL(true)`
3. Shows alert to restart app
4. After restart, React Native applies RTL transformations:
   - FlexDirection reversed
   - Text alignment reversed
   - Navigation stack animations reversed

**Note**: StyleSheet properties should use logical properties for RTL compatibility:
- Use `marginStart`/`marginEnd` instead of `marginLeft`/`marginRight`
- Use `paddingStart`/`paddingEnd` instead of `paddingLeft`/`paddingRight`
- Use `start`/`end` instead of `left`/`right`

### Date Formatting Examples
```typescript
// English
formatPostTimestamp(date, 'en') // "5 minutes ago" or "Jan 24, 2026"

// Japanese
formatPostTimestamp(date, 'ja') // "5分前" or "2026年1月24日"

// Arabic
formatPostTimestamp(date, 'ar') // "منذ ٥ دقائق" or "٢٤ يناير ٢٠٢٦"
```

## Testing

### Automated Tests
- `__tests__/i18n/translationCoverage.test.ts`: 46 tests covering translation completeness, consistency, RTL, Japanese script, critical keys, and translation function behavior.
- All 46 tests passing ✅

### Manual Testing
1. Navigate to Settings → Language
2. Tap each language button
3. Verify all UI text updates immediately
4. Test Arabic: Verify restart prompt appears
5. Restart app after selecting Arabic
6. Verify layout is RTL (right-aligned text, reversed navigation)
7. Test date formatting in posts/chat across all locales

## Future Enhancements
- **Pluralization keys**: Add keys with `_one`/`_other` suffixes for count-based strings
- **Context support**: Add contextual translations (e.g., "Post" as noun vs verb)
- **Namespace support**: Organize translations into feature-based namespaces
- **Translation management**: Integrate with translation management service (e.g., Lokalise, Crowdin)
- **StyleSheet RTL migration**: Convert remaining 68 instances of `marginLeft/Right` to `marginStart/End`